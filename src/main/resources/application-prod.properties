# =========================
# App / Server
# =========================
spring.application.name=reputul-backend
server.port=8080

# Tomcat
server.tomcat.max-threads=50
server.tomcat.accept-count=50
server.http2.enabled=false
server.compression.enabled=true

# =========================
# DataSource / Hikari
# =========================
# IMPORTANT: On Railway set SPRING_PROFILES_ACTIVE=prod and ensure DATABASE_URL is a JDBC Postgres URL:
# jdbc:postgresql://HOST:PORT/DB?sslmode=require
spring.datasource.url=${DATABASE_URL}
spring.datasource.username=${DB_USER:postgres}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# Hikari pool
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.pool-name=HikariPool-1

# =========================
# Flyway (migrations)
# =========================
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.schemas=public
spring.flyway.default-schema=public
spring.flyway.validate-on-migrate=true
spring.flyway.clean-disabled=true
spring.flyway.fail-on-missing-locations=true
spring.flyway.out-of-order=false

# Baseline is OFF by default (safer). Turn it on one-time in Railway with:
# FLYWAY_BASELINE_ON_MIGRATE=true and (optionally) FLYWAY_BASELINE_VERSION=001
spring.flyway.baseline-on-migrate=${FLYWAY_BASELINE_ON_MIGRATE:false}
spring.flyway.baseline-version=${FLYWAY_BASELINE_VERSION:001}

# =========================
# JPA / Hibernate
# =========================
# Validate schema only in prod; never create/update
spring.jpa.hibernate.ddl-auto=validate

# Let Hibernate choose the dialect automatically (avoid warning by not forcing it)
# spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.generate_statistics=false
spring.jpa.show-sql=false

# Ensure JDBC timestamps are handled as UTC (good with TIMESTAMPTZ + OffsetDateTime)
spring.jpa.properties.hibernate.jdbc.time_zone=UTC

# =========================
# Logging
# =========================
logging.level.root=INFO
# Make Flyway log visible in Railway to confirm it runs
logging.level.org.flywaydb=INFO

# =========================
# CORS
# =========================
cors.allowed.origins=${CORS_ALLOWED_ORIGINS}

# =========================
# JWT
# =========================
jwt.secret=${JWT_SECRET}

# =========================
# SendGrid
# =========================
sendgrid.api.key=${SENDGRID_API_KEY}
sendgrid.from.email=${SENDGRID_FROM_EMAIL}
sendgrid.from.name=${SENDGRID_FROM_NAME}

# =========================
# Base App URL
# =========================
app.base.url=${APP_BASE_URL}

# =========================
# Twilio / SMS
# =========================
twilio.account_sid=${TWILIO_ACCOUNT_SID}
twilio.auth_token=${TWILIO_AUTH_TOKEN}
twilio.phone_number=${TWILIO_PHONE_NUMBER}
sms.enabled=true
sms.daily_limit=500

# =========================
# ConvertKit
# =========================
convertkit.api.key=${CONVERTKIT_API_KEY}
convertkit.form.id.waitlist=${CONVERTKIT_FORM_ID_WAITLIST}
convertkit.tag.name=${CONVERTKIT_TAG_NAME}

# =========================
# Stripe
# =========================
stripe.secret.key=${STRIPE_SECRET_KEY}
stripe.webhook.secret=${STRIPE_WEBHOOK_SECRET}
stripe.price.solo=${STRIPE_PRICE_SOLO}
stripe.price.pro=${STRIPE_PRICE_PRO}
stripe.price.growth=${STRIPE_PRICE_GROWTH}
stripe.price.sms.metered=${STRIPE_PRICE_SMS_METERED}
stripe.coupon.100.off=${STRIPE_COUPON_100_OFF}
stripe.coupon.50.off=${STRIPE_COUPON_50_OFF}
frontend.url=${FRONTEND_URL}
billing.portal.return.url=${BILLING_PORTAL_RETURN_URL}
# Beta promo codes
beta.promo.codes=${BETA_PROMO_CODES:BETA2024,EARLYACCESS,LAUNCH50}



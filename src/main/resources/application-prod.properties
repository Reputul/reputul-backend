# ============================================================================
# REPUTUL BACKEND - PRODUCTION CONFIGURATION
# ============================================================================
# Profile: prod
# Description: Production environment settings for Railway/Render deployment
# Last Updated: January 2025
# ============================================================================

# ============================================================================
# APPLICATION METADATA
# ============================================================================
spring.application.name=reputul-backend
# ============================================================================
# SERVER CONFIGURATION
# ============================================================================
server.port=${PORT:8080}

# Tomcat Settings
server.tomcat.max-threads=50
server.tomcat.accept-count=50

# Compression
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024

# HTTP/2 Support
server.http2.enabled=true

# Request Timeout
spring.mvc.async.request-timeout=30000

# Error Handling (Production - Hide Internal Details)
server.error.include-message=never
server.error.include-binding-errors=never
server.error.include-stacktrace=never
server.error.include-exception=false

# ============================================================================
# APPLICATION URLS
# ============================================================================
app.frontend.url=${FRONTEND_URL:https://app.reputul.com}
app.backend.url=${BACKEND_URL:https://api.reputul.com}
app.base.url=${APP_BASE_URL:https://app.reputul.com}

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# IMPORTANT: On Railway, DATABASE_URL should be a JDBC PostgreSQL URL:
# jdbc:postgresql://HOST:PORT/DATABASE?sslmode=require
spring.datasource.url=${DATABASE_URL}
spring.datasource.username=${DB_USER:postgres}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# Hikari Connection Pool
spring.datasource.hikari.maximum-pool-size=${DB_POOL_SIZE:10}
spring.datasource.hikari.minimum-idle=${DB_POOL_MIN_IDLE:2}
spring.datasource.hikari.pool-name=HikariPool-Production
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

# ============================================================================
# JPA / HIBERNATE CONFIGURATION
# ============================================================================
# Production: Validate schema only (never create/update)
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.open-in-view=false
spring.jpa.show-sql=false

# Hibernate Properties
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.generate_statistics=false
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# ============================================================================
# FLYWAY DATABASE MIGRATIONS
# ============================================================================
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.schemas=public
spring.flyway.default-schema=public
spring.flyway.validate-on-migrate=true
spring.flyway.clean-disabled=true
spring.flyway.fail-on-missing-locations=true
spring.flyway.out-of-order=false

# Baseline Settings (use one-time if needed)
spring.flyway.baseline-on-migrate=${FLYWAY_BASELINE_ON_MIGRATE:false}
spring.flyway.baseline-version=${FLYWAY_BASELINE_VERSION:001}

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================
logging.level.root=INFO
logging.level.com.reputul=INFO
logging.level.org.springframework=WARN
logging.level.org.hibernate=WARN
logging.level.org.flywaydb=INFO

# File Logging (if not using platform logging)
logging.file.name=${LOG_FILE_PATH:logs/reputul-production.log}
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================

# CORS - Production Domains Only
cors.allowed.origins=${CORS_ALLOWED_ORIGINS:https://app.reputul.com,https://www.reputul.com}

# JWT Authentication
jwt.secret=${JWT_SECRET}
jwt.expiration=${JWT_EXPIRATION:3600000}

# ============================================================================
# OAUTH INTEGRATIONS - GOOGLE MY BUSINESS
# ============================================================================
# CRITICAL: Must match exactly with Google Cloud Console settings
google.oauth.client-id=${GOOGLE_CLIENT_ID}
google.oauth.client-secret=${GOOGLE_CLIENT_SECRET}
google.oauth.redirect-uri=${GOOGLE_REDIRECT_URI:https://app.reputul.com/oauth/callback/google}

# Google API Configuration
google.api.version=v4
google.api.timeout=30000
google.api.retry.max-attempts=3
google.api.retry.initial-delay=1000

# ============================================================================
# OAUTH INTEGRATIONS - FACEBOOK
# ============================================================================
# CRITICAL: Must match exactly with Facebook App Settings
facebook.oauth.app-id=${FACEBOOK_APP_ID}
facebook.oauth.app-secret=${FACEBOOK_APP_SECRET}
facebook.oauth.redirect-uri=${FACEBOOK_REDIRECT_URI:https://app.reputul.com/oauth/callback/facebook}

# Facebook API Configuration
facebook.api.version=v21.0
facebook.api.rate-limit=${FACEBOOK_RATE_LIMIT:1000}
facebook.api.rate-limit-window=3600
facebook.api.timeout=30000
facebook.api.retry.max-attempts=3
facebook.api.retry.initial-delay=1000
facebook.api.retry.max-delay=10000
facebook.api.retry.multiplier=2.0

# Token Configuration
facebook.token.short-lived-expiry=3600
facebook.token.long-lived-expiry=5184000
facebook.token.refresh-threshold=604800

# ============================================================================
# EMAIL SERVICE - SENDGRID
# ============================================================================
sendgrid.api.key=${SENDGRID_API_KEY}
sendgrid.from.email=${SENDGRID_FROM_EMAIL}
sendgrid.from.name=${SENDGRID_FROM_NAME}

# Email Configuration
email.enabled=true
email.retry.max-attempts=3
email.rate-limit=100

# ============================================================================
# SMS SERVICE - TWILIO
# ============================================================================
twilio.account_sid=${TWILIO_ACCOUNT_SID}
twilio.auth_token=${TWILIO_AUTH_TOKEN}
twilio.phone_number=${TWILIO_PHONE_NUMBER}

# SMS Configuration
sms.enabled=true
sms.daily_limit=${SMS_DAILY_LIMIT:5000}
sms.rate_limit_per_hour=${SMS_RATE_LIMIT_PER_HOUR:500}
sms.default_country_code=+1

# SMS Template Configuration
sms.template.max_length=1600
sms.template.single_sms_limit=160
sms.template.unicode_limit=70

# SMS Delivery Configuration
sms.delivery.retry_attempts=3
sms.delivery.retry_delay_seconds=30
sms.delivery.timeout_seconds=300

# SMS Webhook Configuration
sms.webhook.enabled=true
sms.webhook.base_url=${SMS_WEBHOOK_BASE_URL:https://api.reputul.com}
sms.webhook.secret=${SMS_WEBHOOK_SECRET}

# SMS Logging (Production - Mask PII)
sms.logging.mask_phone_numbers=true
sms.logging.log_message_content=false
sms.logging.log_delivery_status=true

# ============================================================================
# BILLING - STRIPE
# ============================================================================
stripe.secret.key=${STRIPE_SECRET_KEY}
stripe.webhook.secret=${STRIPE_WEBHOOK_SECRET}

# Stripe Price IDs
stripe.price.solo=${STRIPE_PRICE_SOLO}
stripe.price.pro=${STRIPE_PRICE_PRO}
stripe.price.growth=${STRIPE_PRICE_GROWTH}
stripe.price.sms.metered=${STRIPE_PRICE_SMS_METERED}

# Stripe Coupons
stripe.coupon.100.off=${STRIPE_COUPON_100_OFF}
stripe.coupon.50.off=${STRIPE_COUPON_50_OFF}

# Billing Portal
billing.portal.return.url=${BILLING_PORTAL_RETURN_URL:https://app.reputul.com/settings/billing}

# Beta Promo Codes
beta.promo.codes=${BETA_PROMO_CODES:BETA2024,EARLYACCESS,LAUNCH50}

# ============================================================================
# MARKETING - CONVERTKIT (Optional)
# ============================================================================
convertkit.api.key=${CONVERTKIT_API_KEY:}
convertkit.form.id.waitlist=${CONVERTKIT_FORM_ID_WAITLIST:}
convertkit.tag.name=${CONVERTKIT_TAG_NAME:reputul-beta}
convertkit.enabled=${CONVERTKIT_ENABLED:false}

# ============================================================================
# BUSINESS INFORMATION (SMS Compliance & Branding)
# ============================================================================
app.business.name=${APP_BUSINESS_NAME:Reputul}
app.support.phone=${APP_SUPPORT_PHONE:1-800-REPUTUL}
app.support.email=${APP_SUPPORT_EMAIL:support@reputul.com}
app.privacy.url=${APP_PRIVACY_URL:https://reputul.com/privacy}
app.terms.url=${APP_TERMS_URL:https://reputul.com/terms}

# ============================================================================
# SCHEDULED JOBS CONFIGURATION
# ============================================================================
# Enable/Disable Automated Jobs
automated-sync.enabled=${AUTOMATED_SYNC_ENABLED:true}

# Review Sync - Every 6 hours
automated-sync.cron=${AUTOMATED_SYNC_CRON:0 0 */6 * * *}

# Token Refresh - Daily at 2 AM UTC
automated-sync.token-refresh-cron=${AUTOMATED_TOKEN_REFRESH_CRON:0 0 2 * * *}

# Health Check - Every hour
automated-sync.health-check-cron=${AUTOMATED_HEALTH_CHECK_CRON:0 0 * * * *}

# Reputation Score Calculation - Daily at 3 AM UTC
reputation.calculation.cron=${REPUTATION_CALCULATION_CRON:0 0 3 * * *}

# Data Cleanup - Weekly on Sunday at 4 AM UTC
data.cleanup.cron=${DATA_CLEANUP_CRON:0 0 4 * * 0}

# ============================================================================
# DATA RETENTION POLICIES
# ============================================================================
data.retention.sync-jobs-days=${DATA_RETENTION_SYNC_JOBS:90}
data.retention.usage-tracking-days=${DATA_RETENTION_USAGE:365}
data.retention.notifications-days=${DATA_RETENTION_NOTIFICATIONS:30}
data.retention.logs-days=${DATA_RETENTION_LOGS:30}

# ============================================================================
# FEATURE FLAGS
# ============================================================================
feature.facebook.integration.enabled=${FEATURE_FACEBOOK_ENABLED:true}
feature.google.integration.enabled=${FEATURE_GOOGLE_ENABLED:true}
feature.yelp.integration.enabled=${FEATURE_YELP_ENABLED:false}
feature.automated.sync.enabled=${FEATURE_AUTOMATED_SYNC_ENABLED:true}
feature.review.responses.enabled=${FEATURE_REVIEW_RESPONSES_ENABLED:false}
feature.reputation.score.enabled=${FEATURE_REPUTATION_SCORE_ENABLED:true}
feature.badges.enabled=${FEATURE_BADGES_ENABLED:true}
feature.widgets.enabled=${FEATURE_WIDGETS_ENABLED:true}
feature.analytics.enabled=${FEATURE_ANALYTICS_ENABLED:true}

# ============================================================================
# MONITORING & OBSERVABILITY
# ============================================================================
# Spring Boot Actuator
management.endpoints.web.exposure.include=${MANAGEMENT_ENDPOINTS:health,info,metrics,prometheus}
management.endpoint.health.show-details=when-authorized
management.endpoint.health.probes.enabled=true
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true

# Metrics Export
management.prometheus.metrics.export.enabled=${PROMETHEUS_ENABLED:true}
management.metrics.enable.jvm=true
management.metrics.enable.process=true
management.metrics.enable.system=true
management.metrics.enable.http=true

# Custom Metrics
metrics.review.sync.enabled=true
metrics.oauth.flow.enabled=true
metrics.api.performance.enabled=true

# ============================================================================
# API DOCUMENTATION
# ============================================================================
# Disable in production for security
springdoc.api-docs.enabled=false
springdoc.swagger-ui.enabled=false

# ============================================================================
# RATE LIMITING
# ============================================================================
rate-limit.enabled=${RATE_LIMIT_ENABLED:true}
rate-limit.oauth.requests-per-5-minutes=10
rate-limit.sync.requests-per-hour=30
rate-limit.api.requests-per-hour=1000

# ============================================================================
# HTTP CLIENT CONFIGURATION
# ============================================================================
http.client.connect-timeout=${HTTP_CONNECT_TIMEOUT:5000}
http.client.read-timeout=${HTTP_READ_TIMEOUT:30000}
http.client.write-timeout=${HTTP_WRITE_TIMEOUT:30000}
http.client.max-in-memory-size=${HTTP_MAX_MEMORY:1048576}

# Webhook Configuration
automation.webhook.connect-timeout=5000
automation.webhook.read-timeout=10000
automation.webhook.write-timeout=10000
automation.webhook.max-in-memory-size=1048576
automation.webhook.max-retries=3
automation.webhook.retry-delay-ms=1000

# ============================================================================
# FILE UPLOAD CONFIGURATION
# ============================================================================
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=${MAX_FILE_SIZE:10MB}
spring.servlet.multipart.max-request-size=${MAX_REQUEST_SIZE:10MB}
spring.servlet.multipart.file-size-threshold=2KB

# ============================================================================
# SESSION CONFIGURATION
# ============================================================================
server.servlet.session.timeout=${SESSION_TIMEOUT:3600}
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.same-site=lax

# ============================================================================
# CACHE CONFIGURATION
# ============================================================================
spring.cache.type=${CACHE_TYPE:simple}
cache.review-stats.ttl=3600
cache.platform-credentials.ttl=300
cache.business-info.ttl=600

# ============================================================================
# ASYNC PROCESSING
# ============================================================================
spring.task.execution.pool.core-size=5
spring.task.execution.pool.max-size=20
spring.task.execution.pool.queue-capacity=100
spring.task.execution.thread-name-prefix=async-task-

# ============================================================================
# SECURITY HEADERS
# ============================================================================
security.headers.frame-options=DENY
security.headers.content-type-options=nosniff
security.headers.xss-protection=1; mode=block
security.headers.hsts.enabled=true
security.headers.hsts.max-age=31536000

# ============================================================================
# ENVIRONMENT-SPECIFIC NOTES
# ============================================================================
#
# Required Environment Variables for Production:
# ---------------------------------------------
# DATABASE_URL - PostgreSQL JDBC URL with SSL
# DB_USER - Database username
# DB_PASSWORD - Database password
# JWT_SECRET - Secure random key (min 256 bits)
#
# GOOGLE_CLIENT_ID - Google OAuth client ID
# GOOGLE_CLIENT_SECRET - Google OAuth client secret
# GOOGLE_REDIRECT_URI - Must match Google Console exactly
#
# FACEBOOK_APP_ID - Facebook app ID
# FACEBOOK_APP_SECRET - Facebook app secret
# FACEBOOK_REDIRECT_URI - Must match Facebook app exactly
#
# SENDGRID_API_KEY - SendGrid API key
# SENDGRID_FROM_EMAIL - Verified sender email
# SENDGRID_FROM_NAME - Sender display name
#
# TWILIO_ACCOUNT_SID - Twilio account SID
# TWILIO_AUTH_TOKEN - Twilio auth token
# TWILIO_PHONE_NUMBER - Twilio phone number
#
# STRIPE_SECRET_KEY - Stripe secret key (sk_live_...)
# STRIPE_WEBHOOK_SECRET - Stripe webhook secret (whsec_...)
# STRIPE_PRICE_SOLO - Stripe price ID for Solo plan
# STRIPE_PRICE_PRO - Stripe price ID for Pro plan
# STRIPE_PRICE_GROWTH - Stripe price ID for Growth plan
#
# CORS_ALLOWED_ORIGINS - Comma-separated production domains
# FRONTEND_URL - Production frontend URL
# BACKEND_URL - Production backend URL
#
# Optional Environment Variables:
# ------------------------------
# PORT - Server port (default: 8080)
# DB_POOL_SIZE - Database connection pool size (default: 10)
# SMS_DAILY_LIMIT - Maximum SMS per day (default: 5000)
# AUTOMATED_SYNC_ENABLED - Enable automated sync (default: true)
# PROMETHEUS_ENABLED - Enable Prometheus metrics (default: true)
#
# ============================================================================
# DEPLOYMENT CHECKLIST
# ============================================================================
#
# Before deploying to production:
# 1. ? Set SPRING_PROFILES_ACTIVE=prod
# 2. ? Configure all required environment variables
# 3. ? Update OAuth redirect URIs in provider consoles
# 4. ? Enable SSL/HTTPS on load balancer
# 5. ? Configure DNS (app.reputul.com, api.reputul.com)
# 6. ? Set up database backups
# 7. ? Configure monitoring and alerts
# 8. ? Test OAuth flows on production URLs
# 9. ? Verify logs are being collected
# 10. ? Run smoke tests
#
# ============================================================================
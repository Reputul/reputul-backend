# ============================================================================
# REPUTUL BACKEND - DEVELOPMENT CONFIGURATION
# ============================================================================
# Profile: dev
# Description: Local development environment with safe defaults
# Last Updated: October 2025
# ============================================================================

# ============================================================================
# APPLICATION METADATA
# ============================================================================
spring.application.name=reputul-backend
spring.profiles.active=dev

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================
server.port=${PORT:8080}

# Development - Show detailed errors for debugging
server.error.include-message=always
server.error.include-binding-errors=always
server.error.include-stacktrace=on_param
server.error.include-exception=true

# ============================================================================
# APPLICATION URLS
# ============================================================================
app.frontend.url=${FRONTEND_URL:http://localhost:3000}
app.backend.url=${BACKEND_URL:http://localhost:8080}
app.base.url=${APP_BASE_URL:http://localhost:3000}
frontend.url=${FRONTEND_URL:http://localhost:3000}
# Widget Configuration
app.widget.cdn-base-url=${WIDGET_CDN_URL:http://localhost:3000/widgets}
app.widget.api-base-url=${WIDGET_API_URL:http://localhost:8080}

# ============================================================================
# DATABASE CONFIGURATION - LOCAL POSTGRESQL
# ============================================================================
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/reputul}
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD:password}
spring.datasource.driver-class-name=org.postgresql.Driver

# Hikari Connection Pool - Development Settings
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.pool-name=HikariPool-Dev
spring.datasource.hikari.connection-timeout=30000

# ============================================================================
# JPA / HIBERNATE CONFIGURATION
# ============================================================================
# Development: Validate schema (Flyway manages changes)
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.open-in-view=false

# Show SQL for debugging (can enable when needed)
spring.jpa.show-sql=${JPA_SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.jdbc.time_zone=UTC

# ============================================================================
# FLYWAY DATABASE MIGRATIONS
# ============================================================================
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0
spring.flyway.validate-on-migrate=true
spring.flyway.clean-disabled=false
spring.flyway.schemas=public
spring.flyway.default-schema=public
spring.flyway.out-of-order=false

# ============================================================================
# LOGGING CONFIGURATION - DEVELOPMENT
# ============================================================================
logging.level.root=INFO
logging.level.com.reputul.backend=INFO
logging.level.org.springframework=INFO
logging.level.org.hibernate=INFO
logging.level.org.flywaydb=DEBUG

# Hibernate SQL Logging (disabled by default, enable when debugging)
logging.level.org.hibernate.SQL=${HIBERNATE_SQL_LOG:WARN}
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
logging.level.org.hibernate.orm.jdbc.bind=WARN

# Scheduling and Task Logging
logging.level.com.reputul.backend.services.AutomationSchedulerService=DEBUG
logging.level.org.springframework.scheduling=DEBUG

# Console Logging Pattern
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} %-5level [%thread] %logger{36} - %msg%n

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================

# CORS - Allow Local Development
cors.allowed.origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:5173}

# JWT Authentication - Development Key (NEVER use in production!)
jwt.secret=${JWT_SECRET:mySecretKey12345678901234567890123456789012345678901234567890}
jwt.expiration=${JWT_EXPIRATION:3600000}

# ============================================================================
# OAUTH INTEGRATIONS - GOOGLE MY BUSINESS
# ============================================================================
google.oauth.client-id=${GOOGLE_CLIENT_ID}
google.oauth.client-secret=${GOOGLE_CLIENT_SECRET}
google.oauth.redirect-uri=${GOOGLE_REDIRECT_URI:http://localhost:3000/oauth/callback/google}

# Google API Configuration
google.api.version=v4
google.api.timeout=30000
google.api.retry.max-attempts=3
google.api.retry.initial-delay=1000

# ============================================================================
# OAUTH INTEGRATIONS - FACEBOOK
# ============================================================================
facebook.oauth.app-id=${FACEBOOK_APP_ID:}
facebook.oauth.app-secret=${FACEBOOK_APP_SECRET}
facebook.oauth.redirect-uri=${FACEBOOK_REDIRECT_URI:http://localhost:3000/oauth/callback/facebook}

# Facebook API Configuration
facebook.api.version=${FACEBOOK_API_VERSION:v21.0}
facebook.api.timeout=30000

# Token Configuration
facebook.token.short-lived-expiry=3600
facebook.token.long-lived-expiry=5184000
facebook.token.refresh-threshold=604800

# Rate Limiting (Development mode - 200 calls/hour)
facebook.api.rate-limit=${FACEBOOK_API_RATE_LIMIT:200}
facebook.api.rate-limit-window=3600

# Retry Configuration
facebook.api.retry.max-attempts=3
facebook.api.retry.initial-delay=1000
facebook.api.retry.max-delay=10000
facebook.api.retry.multiplier=2.0


# ============================================================================
# EMAIL SERVICE - SENDGRID
# ============================================================================
# Safe defaults for development (won't crash if not configured)
sendgrid.api.key=${SENDGRID_API_KEY:SG.fake-key-for-development}
sendgrid.from.email=${SENDGRID_FROM_EMAIL:noreply@localhost.com}
sendgrid.from.name=${SENDGRID_FROM_NAME:Reputul Dev}

# Email Configuration
email.enabled=${EMAIL_ENABLED:false}
email.retry.max-attempts=3

# ============================================================================
# SMS SERVICE - TWILIO
# ============================================================================
# Safe defaults for development (won't crash if not configured)
twilio.account_sid=${TWILIO_ACCOUNT_SID:ACfake-sid-for-development}
twilio.auth_token=${TWILIO_AUTH_TOKEN:fake-token-for-development}
twilio.phone_number=${TWILIO_PHONE_NUMBER:+14078185210}

# SMS Configuration - Development
sms.enabled=${SMS_ENABLED:false}
sms.daily_limit=${SMS_DAILY_LIMIT:100}
sms.rate_limit_per_hour=${SMS_RATE_LIMIT_PER_HOUR:50}
sms.default_country_code=${SMS_DEFAULT_COUNTRY_CODE:+1}

# SMS Template Settings
sms.template.max_length=1600
sms.template.single_sms_limit=160
sms.template.unicode_limit=70

# SMS Delivery Configuration
sms.delivery.retry_attempts=3
sms.delivery.retry_delay_seconds=30
sms.delivery.timeout_seconds=300

# SMS Webhook Configuration
sms.webhook.enabled=true
sms.webhook.base_url=${SMS_WEBHOOK_BASE_URL:http://localhost:8080}
sms.webhook.secret=${SMS_WEBHOOK_SECRET:defaultSecret}

# SMS Logging - Development (can see full content)
sms.logging.mask_phone_numbers=false
sms.logging.log_message_content=true
sms.logging.log_delivery_status=true

# ============================================================================
# BILLING - STRIPE
# ============================================================================
# Safe defaults for development (test mode keys)
stripe.secret.key=${STRIPE_SECRET_KEY:sk_test_fake_key_for_development}
stripe.webhook.secret=${STRIPE_WEBHOOK_SECRET:whsec_fake_secret_for_development}

# Stripe Price IDs (development/test mode)
stripe.price.solo=${STRIPE_PRICE_SOLO:price_fake_solo}
stripe.price.pro=${STRIPE_PRICE_PRO:price_fake_pro}
stripe.price.growth=${STRIPE_PRICE_GROWTH:price_fake_growth}
stripe.price.sms.metered=${STRIPE_PRICE_SMS_METERED:price_fake_sms}

# Stripe Coupons
stripe.coupon.100.off=${STRIPE_COUPON_100_OFF:100-percent-off}
stripe.coupon.50.off=${STRIPE_COUPON_50_OFF:50-percent-off}

# Billing Portal
billing.portal.return.url=${BILLING_PORTAL_RETURN_URL:http://localhost:3000/settings/billing}

# Beta Promo Codes
beta.promo.codes=${BETA_PROMO_CODES:BETA2024,EARLYACCESS,LAUNCH50}

# ============================================================================
# MARKETING - CONVERTKIT (Optional)
# ============================================================================
convertkit.api.key=${CONVERTKIT_API_KEY:}
convertkit.form.id.waitlist=${CONVERTKIT_FORM_ID_WAITLIST:}
convertkit.tag.name=${CONVERTKIT_TAG_NAME:reputul-dev}
convertkit.enabled=${CONVERTKIT_ENABLED:false}

# ============================================================================
# BUSINESS INFORMATION
# ============================================================================
app.business.name=${APP_BUSINESS_NAME:Reputul Dev}
app.support.phone=${APP_SUPPORT_PHONE:1-800-REPUTUL}
app.support.email=${APP_SUPPORT_EMAIL:support@reputul.com}
app.privacy.url=${APP_PRIVACY_URL:http://localhost:3000/privacy}
app.terms.url=${APP_TERMS_URL:http://localhost:3000/terms}

# ============================================================================
# SCHEDULED JOBS CONFIGURATION
# ============================================================================
# Disable automated jobs by default in development (enable when testing)
automated-sync.enabled=${AUTOMATED_SYNC_ENABLED:false}

# Job Schedules (if enabled)
automated-sync.cron=${AUTOMATED_SYNC_CRON:0 0 */6 * * *}
automated-sync.token-refresh-cron=${AUTOMATED_TOKEN_REFRESH_CRON:0 0 2 * * *}
automated-sync.health-check-cron=${AUTOMATED_HEALTH_CHECK_CRON:0 0 * * * *}
reputation.calculation.cron=${REPUTATION_CALCULATION_CRON:0 0 3 * * *}
data.cleanup.cron=${DATA_CLEANUP_CRON:0 0 4 * * 0}

# Campaign Scheduler Settings
campaign.scheduler.enabled=${CAMPAIGN_SCHEDULER_ENABLED:true}
campaign.scheduler.check-interval=${CAMPAIGN_CHECK_INTERVAL:60000}
campaign.scheduler.batch-size=50
campaign.cleanup.enabled=true
campaign.cleanup.retention-days=90

# ============================================================================
# ASYNC & TASK EXECUTION
# ============================================================================
# Spring Task Scheduling
spring.task.scheduling.pool.size=3
spring.task.execution.pool.core-size=5
spring.task.execution.pool.max-size=20
spring.task.execution.pool.queue-capacity=100
spring.task.execution.thread-name-prefix=dev-task-

# ============================================================================
# DATA RETENTION POLICIES
# ============================================================================
data.retention.sync-jobs-days=${DATA_RETENTION_SYNC_JOBS:90}
data.retention.usage-tracking-days=${DATA_RETENTION_USAGE:365}
data.retention.notifications-days=${DATA_RETENTION_NOTIFICATIONS:30}
data.retention.logs-days=${DATA_RETENTION_LOGS:7}

# ============================================================================
# FEATURE FLAGS - DEVELOPMENT
# ============================================================================
feature.facebook.integration.enabled=${FEATURE_FACEBOOK_ENABLED:true}
feature.google.integration.enabled=${FEATURE_GOOGLE_ENABLED:true}
feature.yelp.integration.enabled=${FEATURE_YELP_ENABLED:false}
feature.automated.sync.enabled=${FEATURE_AUTOMATED_SYNC_ENABLED:false}
feature.review.responses.enabled=${FEATURE_REVIEW_RESPONSES_ENABLED:true}
feature.reputation.score.enabled=${FEATURE_REPUTATION_SCORE_ENABLED:true}
feature.badges.enabled=${FEATURE_BADGES_ENABLED:true}
feature.widgets.enabled=${FEATURE_WIDGETS_ENABLED:true}
feature.analytics.enabled=${FEATURE_ANALYTICS_ENABLED:true}

# ============================================================================
# API DOCUMENTATION - DEVELOPMENT
# ============================================================================
# Enable Swagger/OpenAPI in development
springdoc.api-docs.enabled=${SPRINGDOC_ENABLED:true}
springdoc.swagger-ui.enabled=${SWAGGER_UI_ENABLED:true}
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.api-docs.path=/v3/api-docs

# ============================================================================
# FILE UPLOAD CONFIGURATION
# ============================================================================
file.upload.dir=${FILE_UPLOAD_DIR:./uploads/logos}
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=${MAX_FILE_SIZE:5MB}
spring.servlet.multipart.max-request-size=${MAX_REQUEST_SIZE:5MB}
spring.servlet.multipart.file-size-threshold=2KB

# ============================================================================
# HTTP CLIENT CONFIGURATION
# ============================================================================
http.client.connect-timeout=${HTTP_CONNECT_TIMEOUT:5000}
http.client.read-timeout=${HTTP_READ_TIMEOUT:30000}
http.client.write-timeout=${HTTP_WRITE_TIMEOUT:30000}
http.client.max-in-memory-size=${HTTP_MAX_MEMORY:1048576}

# Webhook Configuration
automation.webhook.connect-timeout=5000
automation.webhook.read-timeout=10000
automation.webhook.write-timeout=10000
automation.webhook.max-in-memory-size=1048576
automation.webhook.max-retries=3
automation.webhook.retry-delay-ms=1000

# ============================================================================
# MONITORING & OBSERVABILITY - DEVELOPMENT
# ============================================================================
# Expose all actuator endpoints in development
management.endpoints.web.exposure.include=*
management.endpoint.health.show-details=always
management.endpoint.health.probes.enabled=true
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true

# Metrics
management.prometheus.metrics.export.enabled=${PROMETHEUS_ENABLED:false}
management.metrics.enable.jvm=true
management.metrics.enable.process=true
management.metrics.enable.system=true

# ============================================================================
# CACHE CONFIGURATION - DEVELOPMENT
# ============================================================================
spring.cache.type=${CACHE_TYPE:simple}
cache.review-stats.ttl=300
cache.platform-credentials.ttl=60
cache.business-info.ttl=300

# ============================================================================
# RATE LIMITING - DEVELOPMENT
# ============================================================================
# Relaxed rate limits for development
rate-limit.enabled=${RATE_LIMIT_ENABLED:false}
rate-limit.oauth.requests-per-5-minutes=100
rate-limit.sync.requests-per-hour=300
rate-limit.api.requests-per-hour=10000

# ============================================================================
# SECURITY - DEVELOPMENT
# ============================================================================
# Relaxed security for local development
security.headers.frame-options=SAMEORIGIN
security.headers.content-type-options=nosniff
security.headers.xss-protection=1; mode=block
security.headers.hsts.enabled=false

# Session Configuration
server.servlet.session.timeout=${SESSION_TIMEOUT:3600}
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=false
server.servlet.session.cookie.same-site=lax

# ============================================================================
# DEVELOPMENT HELPERS
# ============================================================================
# Hot reload
spring.devtools.restart.enabled=${DEVTOOLS_ENABLED:true}
spring.devtools.livereload.enabled=${LIVERELOAD_ENABLED:true}

# H2 Console (if using H2 for testing)
spring.h2.console.enabled=false

# Debug Mode
debug=${DEBUG_MODE:false}

# ============================================================================
# DEVELOPMENT NOTES
# ============================================================================
#
# Quick Start for Local Development:
# -----------------------------------
# 1. Start PostgreSQL: docker-compose up -d postgres
# 2. Create database: createdb reputul
# 3. Run migrations: mvn flyway:migrate
# 4. Start app: mvn spring-boot:run
# 5. Access Swagger: http://localhost:8080/swagger-ui.html
# 6. Access H2 Console (if enabled): http://localhost:8080/h2-console
#
# Optional Environment Variables:
# -------------------------------
# DB_URL - Override database URL
# DB_USERNAME - Override database username
# DB_PASSWORD - Override database password
# GOOGLE_CLIENT_ID - For testing Google OAuth
# GOOGLE_CLIENT_SECRET - For testing Google OAuth
# FACEBOOK_APP_ID - For testing Facebook OAuth
# FACEBOOK_APP_SECRET - For testing Facebook OAuth
# SENDGRID_API_KEY - For testing email sending
# TWILIO_ACCOUNT_SID - For testing SMS
# TWILIO_AUTH_TOKEN - For testing SMS
# STRIPE_SECRET_KEY - Use test mode key (sk_test_...)
#
# Testing OAuth Flows Locally:
# ----------------------------
# 1. Set up ngrok for local HTTPS testing:
#    ngrok http 3000
# 2. Update OAuth redirect URIs to use ngrok URL:
#    https://your-ngrok-url.ngrok.io/oauth/callback/facebook
# 3. Update environment variables:
#    FACEBOOK_REDIRECT_URI=https://your-ngrok-url.ngrok.io/oauth/callback/facebook
#
# Debugging Tips:
# ---------------
# - Enable SQL logging: JPA_SHOW_SQL=true
# - Enable Hibernate logging: HIBERNATE_SQL_LOG=DEBUG
# - Enable all actuator endpoints for inspection
# - Use Swagger UI for API testing
# - Check logs at: logs/reputul-dev.log
# - Use H2 console for quick database inspection
#
# Common Development Commands:
# ---------------------------
# mvn spring-boot:run                    # Start application
# mvn clean install                      # Build project
# mvn test                               # Run tests
# mvn flyway:migrate                     # Run migrations
# mvn flyway:clean                       # Clean database (BE CAREFUL!)
# mvn flyway:info                        # Show migration status
#
# ============================================================================